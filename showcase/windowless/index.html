<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>창 없이 Wgpu 사용하기 | WGPU 학습하기</title>
    <meta name="generator" content="VuePress 1.9.10">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/learn-wgpu-ko/assets/css/0.styles.146801cf.css" as="style"><link rel="preload" href="/learn-wgpu-ko/assets/js/app.ed4e872b.js" as="script"><link rel="preload" href="/learn-wgpu-ko/assets/js/3.d666109b.js" as="script"><link rel="preload" href="/learn-wgpu-ko/assets/js/2.3bb15672.js" as="script"><link rel="preload" href="/learn-wgpu-ko/assets/js/52.657fe2a7.js" as="script"><link rel="preload" href="/learn-wgpu-ko/assets/js/37.a2b9f953.js" as="script"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/1.187b396e.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/10.1c2d648c.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/11.3ec612b9.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/12.e324cc11.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/13.84916e1a.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/14.109a5894.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/15.887bfa51.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/16.4611bcb5.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/17.27051486.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/18.f6ad2768.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/19.40ff5aaa.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/20.178554f0.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/21.9e299fcc.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/22.c7ead717.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/23.ab028ab4.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/24.fc889c2f.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/25.941e3dd6.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/26.f270b4cd.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/27.858fd637.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/28.0f431dfe.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/29.098da917.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/30.379eac67.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/31.3b679374.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/32.f42ff376.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/33.ac5b507a.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/34.50a4fad6.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/35.be37c498.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/36.f68470b2.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/38.10571145.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/39.91625f3e.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/4.67c56359.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/40.7624e351.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/41.64fc17ac.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/42.982865cf.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/43.d9e52ef4.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/44.ceca1b93.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/45.548c112a.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/46.78ab4e7a.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/47.4e1443b2.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/48.52917e17.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/49.a2e992fc.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/5.c397ffe5.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/50.987eb2eb.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/51.ddc3d442.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/53.cd02a60a.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/54.26e3ff32.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/55.7997dcfe.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/56.d2d6a79c.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/57.f668ee64.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/58.e4f7de44.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/59.2b497232.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/6.0dfb00be.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/60.718010a4.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/61.4c5bf94a.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/62.e415c60b.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/63.bee4456e.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/64.b96d6991.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/65.988ffa7f.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/66.1407089c.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/67.e45af5aa.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/68.042b0ded.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/69.aef532a8.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/70.909ab186.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/71.4ed07975.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/72.31befa51.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/9.a241c78d.js"><link rel="prefetch" href="/learn-wgpu-ko/assets/js/vendors~docsearch.d7f0baa9.js">
    <link rel="stylesheet" href="/learn-wgpu-ko/assets/css/0.styles.146801cf.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="inner"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/learn-wgpu-ko/" class="home-link router-link-active"><!----> <span class="site-name">WGPU 학습하기</span></a> <div class="links"><!----> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="docs-layout"><aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/learn-wgpu-ko/" aria-current="page" class="sidebar-link">소개</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>초보자</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu-ko/beginner/tutorial1-window/" class="sidebar-link">의존성과 윈도우</a></li><li><a href="/learn-wgpu-ko/beginner/tutorial2-surface/" class="sidebar-link">표면(The Surface)</a></li><li><a href="/learn-wgpu-ko/beginner/tutorial3-pipeline/" class="sidebar-link">파이프라인</a></li><li><a href="/learn-wgpu-ko/beginner/tutorial4-buffer/" class="sidebar-link">버퍼와 인덱스</a></li><li><a href="/learn-wgpu-ko/beginner/tutorial5-textures/" class="sidebar-link">텍스처와 바인드 그룹</a></li><li><a href="/learn-wgpu-ko/beginner/tutorial6-uniforms/" class="sidebar-link">유니폼 버퍼와 3D 카메라</a></li><li><a href="/learn-wgpu-ko/beginner/tutorial7-instancing/" class="sidebar-link">인스턴싱(Instancing)</a></li><li><a href="/learn-wgpu-ko/beginner/tutorial8-depth/" class="sidebar-link">깊이 버퍼 (The Depth Buffer)</a></li><li><a href="/learn-wgpu-ko/beginner/tutorial9-models/" class="sidebar-link">모델 로딩</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>중급자</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu-ko/intermediate/tutorial10-lighting/" class="sidebar-link">조명 다루기</a></li><li><a href="/learn-wgpu-ko/intermediate/tutorial11-normals/" class="sidebar-link">노멀 매핑 (Normal Mapping)</a></li><li><a href="/learn-wgpu-ko/intermediate/tutorial12-camera/" class="sidebar-link">더 나은 카메라</a></li><li><a href="/learn-wgpu-ko/intermediate/tutorial13-hdr/" class="sidebar-link">하이 다이내믹 레인지 렌더링 (High Dynamic Range Rendering)</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>쇼케이스</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/learn-wgpu-ko/showcase/" aria-current="page" class="sidebar-link">들어가며</a></li><li><a href="/learn-wgpu-ko/showcase/windowless/" aria-current="page" class="active sidebar-link">창 없이 Wgpu 사용하기</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/learn-wgpu-ko/showcase/windowless/#무엇을-해야-할까요" class="sidebar-link">무엇을 해야 할까요?</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-ko/showcase/windowless/#창-없이-삼각형-그리기" class="sidebar-link">창 없이 삼각형 그리기</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-ko/showcase/windowless/#버퍼에서-데이터-꺼내기" class="sidebar-link">버퍼에서 데이터 꺼내기</a></li><li class="sidebar-sub-header"><a href="/learn-wgpu-ko/showcase/windowless/#main-함수는-async로-만들-수-없습니다" class="sidebar-link">main 함수는 async로 만들 수 없습니다</a></li></ul></li><li><a href="/learn-wgpu-ko/showcase/gifs/" class="sidebar-link">GIF 만들기</a></li><li><a href="/learn-wgpu-ko/showcase/pong/" class="sidebar-link">퐁 (Pong)</a></li><li><a href="/learn-wgpu-ko/showcase/compute/" class="sidebar-link">컴퓨트 예제: 탄젠트와 바이탄젠트 계산</a></li><li><a href="/learn-wgpu-ko/showcase/alignment/" class="sidebar-link">WGSL의 메모리 레이아웃</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>뉴스</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="창-없이-wgpu-사용하기"><a href="#창-없이-wgpu-사용하기" class="header-anchor">#</a> 창 없이 Wgpu 사용하기</h1> <p>때로는 단순히 GPU의 성능을 최대한 활용하고 싶을 때가 있습니다. 대규모의 숫자 집합을 병렬로 처리하고 싶을 수도 있고, 3D 영화 작업을 하면서 패스 트레이싱으로 사실적인 장면을 만들어야 할 수도 있습니다. 혹은 암호화폐를 채굴할 수도 있죠. 이 모든 상황에서, 우리는 진행 상황을 화면으로 <em>반드시</em> 볼 필요는 없습니다.</p> <h2 id="무엇을-해야-할까요"><a href="#무엇을-해야-할까요" class="header-anchor">#</a> 무엇을 해야 할까요?</h2> <p>사실 꽤 간단합니다. <code>Instance</code>를 생성하는 데 창이 <em>필요하지 않고</em>, <code>Adapter</code>를 선택하는 데도 창이 <em>필요하지 않으며</em>, <code>Device</code>를 만드는 데도 창이 <em>필요하지 않습니다</em>. 창이 필요했던 유일한 이유는 <code>SwapChain</code>을 만들기 위해 <code>Surface</code>가 필요했기 때문입니다. <code>Device</code>가 있다면, GPU에 명령을 보내기 위한 모든 준비가 된 것입니다.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> adapter <span class="token operator">=</span> instance
    <span class="token punctuation">.</span><span class="token function">request_adapter</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">RequestAdapterOptions</span> <span class="token punctuation">{</span>
        power_preference<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PowerPreference</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        compatible_surface<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">await</span>
    <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token punctuation">(</span>device<span class="token punctuation">,</span> queue<span class="token punctuation">)</span> <span class="token operator">=</span> adapter
    <span class="token punctuation">.</span><span class="token function">request_device</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">Default</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">None</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token keyword">await</span>
    <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="창-없이-삼각형-그리기"><a href="#창-없이-삼각형-그리기" class="header-anchor">#</a> 창 없이 삼각형 그리기</h2> <p>지금까지는 GPU가 하는 일을 볼 필요가 없다고 이야기했지만, 어느 시점에서는 결과를 확인해야 합니다. <a href="/learn-wgpu-ko/beginner/tutorial2-surface/#render">surface 튜토리얼</a>을 다시 살펴보면, <code>surface.get_current_texture()</code>를 사용해 렌더링할 텍스처를 가져왔습니다. 우리는 이제 그 단계를 건너뛰고 텍스처를 직접 만들 것입니다. 여기서 한 가지 주목할 점은, PNG는 BGRA가 아닌 RGBA를 사용하므로 <code>format</code>에 <code>surface.get_preferred_format(&amp;adapter)</code> 대신 <code>wgpu::TextureFormat::Rgba8UnormSrgb</code>를 지정해야 한다는 것입니다.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> texture_size <span class="token operator">=</span> <span class="token number">256u32</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> texture_desc <span class="token operator">=</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureDescriptor</span> <span class="token punctuation">{</span>
    size<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Extent3d</span> <span class="token punctuation">{</span>
        width<span class="token punctuation">:</span> texture_size<span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> texture_size<span class="token punctuation">,</span>
        depth_or_array_layers<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    mip_level_count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    sample_count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    dimension<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureDimension</span><span class="token punctuation">::</span><span class="token constant">D2</span><span class="token punctuation">,</span>
    format<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureFormat</span><span class="token punctuation">::</span><span class="token class-name">Rgba8UnormSrgb</span><span class="token punctuation">,</span>
    usage<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureUsages</span><span class="token punctuation">::</span><span class="token constant">COPY_SRC</span>
        <span class="token operator">|</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureUsages</span><span class="token punctuation">::</span><span class="token constant">RENDER_ATTACHMENT</span>
        <span class="token punctuation">,</span>
    label<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> texture <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_texture</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>texture_desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> texture_view <span class="token operator">=</span> texture<span class="token punctuation">.</span><span class="token function">create_view</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token class-name">Default</span><span class="token punctuation">::</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>TextureUsages::RENDER_ATTACHMENT</code>는 wgpu가 우리 텍스처에 렌더링할 수 있도록 하기 위해 사용합니다. <code>TextureUsages::COPY_SRC</code>는 텍스처에서 데이터를 꺼내와 파일에 저장할 수 있도록 하기 위함입니다.</p> <p>이 텍스처를 사용해 삼각형을 그릴 수는 있지만, 그 안의 픽셀 데이터에 접근할 방법이 필요합니다. <a href="/learn-wgpu-ko/beginner/tutorial5-textures/">텍스처 튜토리얼</a>에서는 버퍼를 사용해 파일에서 색상 데이터를 로드한 다음, 그 버퍼를 텍스처에 복사했습니다. 이제는 그 반대 과정을 할 것입니다: 텍스처에서 버퍼로 데이터를 복사하여 파일로 저장할 것입니다. 데이터를 담을 만큼 충분히 큰 버퍼가 필요합니다.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// 나중에 사용하기 위해 이 값을 저장해야 합니다.</span>
<span class="token keyword">let</span> u32_size <span class="token operator">=</span> <span class="token namespace">std<span class="token punctuation">::</span>mem<span class="token punctuation">::</span></span><span class="token function">size_of</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token keyword">u32</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">u32</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> output_buffer_size <span class="token operator">=</span> <span class="token punctuation">(</span>u32_size <span class="token operator">*</span> texture_size <span class="token operator">*</span> texture_size<span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BufferAddress</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> output_buffer_desc <span class="token operator">=</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BufferDescriptor</span> <span class="token punctuation">{</span>
    size<span class="token punctuation">:</span> output_buffer_size<span class="token punctuation">,</span>
    usage<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BufferUsages</span><span class="token punctuation">::</span><span class="token constant">COPY_DST</span>
        <span class="token comment">// wgpu에게 이 버퍼를 CPU에서 읽고 싶다고 알립니다.</span>
        <span class="token operator">|</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BufferUsages</span><span class="token punctuation">::</span><span class="token constant">MAP_READ</span><span class="token punctuation">,</span>
    label<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
    mapped_at_creation<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> output_buffer <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_buffer</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>output_buffer_desc<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>이제 그릴 대상을 만들었으니, 그릴 내용을 만들어 봅시다. 단순히 삼각형 하나를 그리는 것이므로, <a href="/learn-wgpu-ko/beginner/tutorial3-pipeline/#writing-the-shaders">파이프라인 튜토리얼</a>에서 셰이더 코드를 가져옵시다.</p> <div class="language-glsl extra-class"><pre class="language-glsl"><code><span class="token comment">// shader.vert</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">450</span></span></span>

<span class="token keyword">const</span> <span class="token keyword">vec2</span> positions<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">vec2</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">(</span>
    <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">vec2</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    gl_Position <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span>positions<span class="token punctuation">[</span>gl_VertexIndex<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-glsl extra-class"><pre class="language-glsl"><code><span class="token comment">// shader.frag</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">version</span> <span class="token expression"><span class="token number">450</span></span></span>

<span class="token keyword">layout</span><span class="token punctuation">(</span>location<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">out</span> <span class="token keyword">vec4</span> f_color<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    f_color <span class="token operator">=</span> <span class="token keyword">vec4</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>SPIR-V 모듈을 지원하도록 의존성을 업데이트합니다.</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">dependencies</span><span class="token punctuation">]</span>
<span class="token key property">image</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.23&quot;</span>
<span class="token key property">shaderc</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.7&quot;</span>
<span class="token key property">wgpu</span> <span class="token punctuation">=</span> <span class="token punctuation">{</span> <span class="token key property">version</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.19&quot;</span><span class="token punctuation">,</span> <span class="token key property">features</span> <span class="token punctuation">=</span> <span class="token punctuation">[</span><span class="token string">&quot;spirv&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
<span class="token key property">pollster</span> <span class="token punctuation">=</span> <span class="token string">&quot;0.3&quot;</span>
</code></pre></div><p>이 셰이더들을 사용해 간단한 <code>RenderPipeline</code>을 만들겠습니다.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> vs_src <span class="token operator">=</span> <span class="token macro property">include_str!</span><span class="token punctuation">(</span><span class="token string">&quot;shader.vert&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> fs_src <span class="token operator">=</span> <span class="token macro property">include_str!</span><span class="token punctuation">(</span><span class="token string">&quot;shader.frag&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token keyword">mut</span> compiler <span class="token operator">=</span> <span class="token namespace">shaderc<span class="token punctuation">::</span></span><span class="token class-name">Compiler</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> vs_spirv <span class="token operator">=</span> compiler
    <span class="token punctuation">.</span><span class="token function">compile_into_spirv</span><span class="token punctuation">(</span>
        vs_src<span class="token punctuation">,</span>
        <span class="token namespace">shaderc<span class="token punctuation">::</span></span><span class="token class-name">ShaderKind</span><span class="token punctuation">::</span><span class="token class-name">Vertex</span><span class="token punctuation">,</span>
        <span class="token string">&quot;shader.vert&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span>
        <span class="token class-name">None</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> fs_spirv <span class="token operator">=</span> compiler
    <span class="token punctuation">.</span><span class="token function">compile_into_spirv</span><span class="token punctuation">(</span>
        fs_src<span class="token punctuation">,</span>
        <span class="token namespace">shaderc<span class="token punctuation">::</span></span><span class="token class-name">ShaderKind</span><span class="token punctuation">::</span><span class="token class-name">Fragment</span><span class="token punctuation">,</span>
        <span class="token string">&quot;shader.frag&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span>
        <span class="token class-name">None</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> vs_data <span class="token operator">=</span> <span class="token namespace">wgpu<span class="token punctuation">::</span>util<span class="token punctuation">::</span></span><span class="token function">make_spirv</span><span class="token punctuation">(</span>vs_spirv<span class="token punctuation">.</span><span class="token function">as_binary_u8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> fs_data <span class="token operator">=</span> <span class="token namespace">wgpu<span class="token punctuation">::</span>util<span class="token punctuation">::</span></span><span class="token function">make_spirv</span><span class="token punctuation">(</span>fs_spirv<span class="token punctuation">.</span><span class="token function">as_binary_u8</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> vs_module <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_shader_module</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ShaderModuleDescriptor</span> <span class="token punctuation">{</span>
    label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Vertex Shader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    source<span class="token punctuation">:</span> vs_data<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> fs_module <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_shader_module</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ShaderModuleDescriptor</span> <span class="token punctuation">{</span>
    label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Fragment Shader&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    source<span class="token punctuation">:</span> fs_data<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> render_pipeline_layout <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_pipeline_layout</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PipelineLayoutDescriptor</span> <span class="token punctuation">{</span>
    label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Render Pipeline Layout&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    bind_group_layouts<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    push_constant_ranges<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> render_pipeline <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_render_pipeline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">RenderPipelineDescriptor</span> <span class="token punctuation">{</span>
    label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Render Pipeline&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    layout<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>render_pipeline_layout<span class="token punctuation">)</span><span class="token punctuation">,</span>
    vertex<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">VertexState</span> <span class="token punctuation">{</span>
        module<span class="token punctuation">:</span> <span class="token operator">&amp;</span>vs_module<span class="token punctuation">,</span>
        entry_point<span class="token punctuation">:</span> <span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span>
        buffers<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    fragment<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">FragmentState</span> <span class="token punctuation">{</span>
        module<span class="token punctuation">:</span> <span class="token operator">&amp;</span>fs_module<span class="token punctuation">,</span>
        entry_point<span class="token punctuation">:</span> <span class="token string">&quot;main&quot;</span><span class="token punctuation">,</span>
        targets<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ColorTargetState</span> <span class="token punctuation">{</span>
            format<span class="token punctuation">:</span> texture_desc<span class="token punctuation">.</span>format<span class="token punctuation">,</span>
            blend<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">BlendState</span><span class="token punctuation">::</span><span class="token constant">REPLACE</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            write_mask<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ColorWrites</span><span class="token punctuation">::</span><span class="token constant">ALL</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    primitive<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PrimitiveState</span> <span class="token punctuation">{</span>
        topology<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PrimitiveTopology</span><span class="token punctuation">::</span><span class="token class-name">TriangleList</span><span class="token punctuation">,</span>
        strip_index_format<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
        front_face<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">FrontFace</span><span class="token punctuation">::</span><span class="token class-name">Ccw</span><span class="token punctuation">,</span>
        cull_mode<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Face</span><span class="token punctuation">::</span><span class="token class-name">Back</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// Fill 이외의 값을 설정하려면 Features::NON_FILL_POLYGON_MODE 가 필요합니다.</span>
        polygon_mode<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PolygonMode</span><span class="token punctuation">::</span><span class="token class-name">Fill</span><span class="token punctuation">,</span>
        <span class="token comment">// Features::DEPTH_CLIP_CONTROL가 필요합니다.</span>
        unclipped_depth<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token comment">// Features::CONSERVATIVE_RASTERIZATION가 필요합니다.</span>
        conservative<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    depth_stencil<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
    multisample<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">MultisampleState</span> <span class="token punctuation">{</span>
        count<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
        mask<span class="token punctuation">:</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span>
        alpha_to_coverage_enabled<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 렌더링할 수 있는 배열 텍스처의 최대 수를 설정합니다.</span>
    multiview<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>이제 인코더(encoder)가 필요하니, 만들어 봅시다.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> <span class="token keyword">mut</span> encoder <span class="token operator">=</span> device<span class="token punctuation">.</span><span class="token function">create_command_encoder</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">CommandEncoderDescriptor</span> <span class="token punctuation">{</span>
    label<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>RenderPass</code> 부분부터 흥미로워집니다. 렌더 패스는 최소한 하나의 color attachment를 필요로 합니다. color attachment는 연결할 <code>TextureView</code>가 필요합니다. 이전에는 <code>SwapChain</code>의 텍스처를 사용했지만, 우리가 만든 <code>texture_view</code>를 포함한 어떤 <code>TextureView</code>든 사용할 수 있습니다.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token punctuation">{</span>
    <span class="token keyword">let</span> render_pass_desc <span class="token operator">=</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">RenderPassDescriptor</span> <span class="token punctuation">{</span>
        label<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token string">&quot;Render Pass&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        color_attachments<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span>
            <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">RenderPassColorAttachment</span> <span class="token punctuation">{</span>
                view<span class="token punctuation">:</span> <span class="token operator">&amp;</span>texture_view<span class="token punctuation">,</span>
                resolve_target<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
                ops<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Operations</span> <span class="token punctuation">{</span>
                    load<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">LoadOp</span><span class="token punctuation">::</span><span class="token class-name">Clear</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Color</span> <span class="token punctuation">{</span>
                        r<span class="token punctuation">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
                        g<span class="token punctuation">:</span> <span class="token number">0.2</span><span class="token punctuation">,</span>
                        b<span class="token punctuation">:</span> <span class="token number">0.3</span><span class="token punctuation">,</span>
                        a<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    store<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">StoreOp</span><span class="token punctuation">::</span><span class="token class-name">Store</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        depth_stencil_attachment<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
        occlusion_query_set<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
        timestamp_writes<span class="token punctuation">:</span> <span class="token class-name">None</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> render_pass <span class="token operator">=</span> encoder<span class="token punctuation">.</span><span class="token function">begin_render_pass</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>render_pass_desc<span class="token punctuation">)</span><span class="token punctuation">;</span>

    render_pass<span class="token punctuation">.</span><span class="token function">set_pipeline</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>render_pipeline<span class="token punctuation">)</span><span class="token punctuation">;</span>
    render_pass<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>데이터가 <code>Texture</code>에 갇혀 있으면 할 수 있는 것이 별로 없으니, <code>output_buffer</code>로 복사합시다.</p> <div class="language-rust extra-class"><pre class="language-rust"><code>encoder<span class="token punctuation">.</span><span class="token function">copy_texture_to_buffer</span><span class="token punctuation">(</span>
    <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ImageCopyTexture</span> <span class="token punctuation">{</span>
        texture<span class="token punctuation">:</span> <span class="token operator">&amp;</span>texture<span class="token punctuation">,</span>
        mip_level<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        origin<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">Origin3d</span><span class="token punctuation">::</span><span class="token constant">ZERO</span><span class="token punctuation">,</span>
        aspect<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">TextureAspect</span><span class="token punctuation">::</span><span class="token class-name">All</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ImageCopyBuffer</span> <span class="token punctuation">{</span>
        buffer<span class="token punctuation">:</span> <span class="token operator">&amp;</span>output_buffer<span class="token punctuation">,</span>
        layout<span class="token punctuation">:</span> <span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">ImageDataLayout</span> <span class="token punctuation">{</span>
            offset<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
            bytes_per_row<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>u32_size <span class="token operator">*</span> texture_size<span class="token punctuation">)</span><span class="token punctuation">,</span>
            rows_per_image<span class="token punctuation">:</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>texture_size<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    texture_desc<span class="token punctuation">.</span>size<span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>이제 모든 명령을 만들었으니, GPU에 제출합시다.</p> <div class="language-rust extra-class"><pre class="language-rust"><code>queue<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">Some</span><span class="token punctuation">(</span>encoder<span class="token punctuation">.</span><span class="token function">finish</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="버퍼에서-데이터-꺼내기"><a href="#버퍼에서-데이터-꺼내기" class="header-anchor">#</a> 버퍼에서 데이터 꺼내기</h2> <p>버퍼에서 데이터를 꺼내려면, 먼저 버퍼를 매핑(map)해야 합니다. 그런 다음 <code>&amp;[u8]</code>처럼 다룰 수 있는 <code>BufferView</code>를 얻을 수 있습니다.</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// 매핑 관련 변수들을 스코프(scope)로 감싸서</span>
<span class="token comment">// 버퍼를 unmap 할 수 있도록 해야 합니다.</span>
<span class="token punctuation">{</span>
    <span class="token keyword">let</span> buffer_slice <span class="token operator">=</span> output_buffer<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">..</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 참고: await를 호출하기 전에 먼저 매핑을 요청한 다음 device.poll()을</span>
    <span class="token comment">// 호출해야 합니다. 그렇지 않으면 애플리케이션이 멈추게 됩니다.</span>
    <span class="token keyword">let</span> <span class="token punctuation">(</span>tx<span class="token punctuation">,</span> rx<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token namespace">futures_intrusive<span class="token punctuation">::</span>channel<span class="token punctuation">::</span>shared<span class="token punctuation">::</span></span><span class="token function">oneshot_channel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buffer_slice<span class="token punctuation">.</span><span class="token function">map_async</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">MapMode</span><span class="token punctuation">::</span><span class="token class-name">Read</span><span class="token punctuation">,</span> <span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>result<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
        tx<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    device<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token namespace">wgpu<span class="token punctuation">::</span></span><span class="token class-name">PollType</span><span class="token punctuation">::</span><span class="token class-name">Wait</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    rx<span class="token punctuation">.</span><span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> data <span class="token operator">=</span> buffer_slice<span class="token punctuation">.</span><span class="token function">get_mapped_range</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">use</span> <span class="token namespace">image<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">ImageBuffer</span><span class="token punctuation">,</span> <span class="token class-name">Rgba</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> buffer <span class="token operator">=</span>
        <span class="token class-name">ImageBuffer</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">Rgba</span><span class="token operator">&lt;</span><span class="token keyword">u8</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> _<span class="token operator">&gt;</span><span class="token punctuation">::</span><span class="token function">from_raw</span><span class="token punctuation">(</span>texture_size<span class="token punctuation">,</span> texture_size<span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token function">as_ref</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    buffer<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token string">&quot;image.png&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
output_buffer<span class="token punctuation">.</span><span class="token function">unmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="note"><p>wgpu 레포지토리의 <a href="https://github.com/gfx-rs/wgpu/tree/master/wgpu/examples/capture" target="_blank" rel="noopener noreferrer">예제<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>에서 사용하는 크레이트인 <a href="https://docs.rs/futures-intrusive" target="_blank" rel="noopener noreferrer">futures-intrusive<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>를 사용했습니다.</p></div> <h2 id="main-함수는-async로-만들-수-없습니다"><a href="#main-함수는-async로-만들-수-없습니다" class="header-anchor">#</a> main 함수는 async로 만들 수 없습니다</h2> <p><code>main()</code> 함수는 future를 반환할 수 없으므로, <code>async</code> 키워드를 사용할 수 없습니다. 이 문제를 해결하기 위해, 코드를 다른 함수에 넣고 <code>main()</code>에서 블록(block) 방식으로 호출할 것입니다. 이를 위해 <a href="https://docs.rs/pollster" target="_blank" rel="noopener noreferrer">pollster 크레이트<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>와 같이 future를 폴링(poll)할 수 있는 크레이트가 필요합니다.</p> <div class="note"><p><a href="https://docs.rs/async-std" target="_blank" rel="noopener noreferrer">async-std<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>나 <a href="https://docs.rs/tokio" target="_blank" rel="noopener noreferrer">tokio<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>와 같은 크레이트를 사용하면 <code>main()</code> 함수에 어노테이션을 붙여 <code>async</code>로 만들 수 있습니다. 하지만 두 크레이트 모두 이 프로젝트에는 조금 무겁다고 판단하여 사용하지 않았습니다. 여러분은 원하는 어떤 비동기 설정이든 자유롭게 사용하셔도 좋습니다 🙂</p></div> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 창 없는 렌더링 코드...</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token namespace">pollster<span class="token punctuation">::</span></span><span class="token function">block_on</span><span class="token punctuation">(</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>이 모든 과정을 마치면 다음과 같은 이미지가 생성될 것입니다.</p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAFq0lEQVR4nO3U2XVcRxBEQcovOiJf5IY8kl8SRLAPAXAweEvvGfFRFlTeP/786+9/vwGRBACCCQAEEwAIJgAQTAAgmABAMAGAYAIAwQQAggkABBMACCYAEEwAIJgAQDABgGACAMEEAIIJAAQTAAgmABBMACCYAEAwAYBgAgDBBACCCQAEEwAIJgAQTAAgmABAMAGAYAIAwQQAggkABBMACCYAEEwAIJgAQDABgGACAMEEAIIJAAQTAAgmABBMACCYAEAwAYBgAgDBBACCCQAEEwAIJgAQTAAgmABAMAGAYAIAwQQAggkABBMACCYAEEwAIJgAQDABgGACAMEEINj3b/+83G8v9/vLJZEABBMABCBUGX8hApkEIJQA8D8BCPRx/IUI5BGAQAJAIQBhPht/IQJZBCCMAPCWAAT5avyFCOQQgCACwEcCEOLo+AsRyCAAIQSARwQgwNnxFyKwPwEIIAB8RgA2d3X8hQjsTQA2JwA8IwAbuzv+QgT2JQAbEwC+IgCbqjX+QgT2JACbEgCOEIAN1R5/IQL7EYANCQBHCcBmWo2/EIG9CMBmBIAzBGAjrcdfiMA+BGAjAsBZArCJXuMvRGAPArAJAeAKAdhA7/EXIrA+AdiAAHCVACxu1PgLEVibACxOALhDABY2evyFCKxLABYmANwlAIuaZfyFCKxJABYlANQgAAuabfyFCKxHABYkANQiAIuZdfyFCKxFABYjANQkAAuZffyFCKxDABYiANQmAItYZfyFCKxBABYhALQgAAtYbfyFCMxPABYgALQiAJNbdfyFCMxNACYnALQkABNbffyFCMxLACYmALQmAJPaZfyFCMxJACYlAPQgABPabfyFCMxHACYkAPQiAJPZdfyFCMxFACYjAPQkABPZffyFCMxDACYiAPQmAJNIGX8hAnMQgEkIACMIwATSxl+IwHgCMAEBYBQBGCx1/IUIjCUAgwmAAIwkAAOlj78QgXEEYCABeCUA4wjAIMb/ngiMIQCDCMB7AjCGAAxg/I+JQH8CMIAAPCYA/QlAZ8b/nAj0JQCdCcBzAtCXAHRk/MeIQD8C0JEAHCMA/QhAJ8Z/jgj0IQCdCMA5AtCHAHRg/NeIQHsC0IEAXCMA7QlAY8Z/jwi0JQCNCcA9AtCWADRk/HWIQDsC0JAA1CEA7QhAI8Zflwi0IQCNCEBdAtCGADRg/G2IQH0C0IAAtCEA9QlAZcbflgjUJQCVCUBbAlCXAFRk/H2IQD0CUJEA9CEA9QhAJcbflwjUIQCVCEBfAlCHAFRg/GOIwH0CUIEAjCEA9wnATcY/lgjcIwA3CcBYAnCPANxg/HMQgesE4AYBmIMAXCcAFxn/XETgGgG4SADmIgDXCMAFxj8nEThPAC4QgDkJwHkCcJLxz00EzhGAkwRgbgJwjgCcYPxrEIHjBOAEAViDABwnAAcZ/1pE4BgBOEgA1iIAxwjAAca/JhH4mgAcIABrEoCvCcAXjH9tIvCcAHxBANYmAM8JwBPGvwcR+JwAPCEAexCAzwnAJ4x/LyLwmAB8QgD2IgCPCcADxr8nEfidADwgAHsSgN8JwAfGvzcReE8APhCAvQnAewLwhvFnEIFfBOANAcggAL8IwE/Gn0UEXgnATwKQRQBeCcAL488kAgLwgwBkEgABeHkB40+WHoH4AEAyAYBgAgDBBACCCQAEEwAIJgAQTAAgmABAMAGAYAIAwQQAggkABBMACCYAEEwAIJgAQDABgGACAMEEAIIJAAQTAAgmABBMACCYAEAwAYBgAgDBBACCCQAEEwAIJgAQTAAgmABAMAGAYAIAwQQAggkABBMACCYAEEwAIJgAQDABgGACAMEEAIIJAAQTAAgmABBMACCYAEAwAYBgAgDBBACCCQAEEwAIJgAQTAAgmABAMAGAYAIAwQQAggkABBMACCYAEEwAINh/p/JoLhfYRNsAAAAASUVORK5CYII=" alt="갈색 삼각형"></p> <div class="auto-github-link"><a href="https://github.com/sotrh/learn-wgpu/tree/master/code/showcase/windowless/" target="_blank" rel="noopener noreferrer">Check out the code!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">6/11/2025, 8:57:07 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/learn-wgpu-ko/showcase/" class="prev router-link-active">
          들어가며
        </a></span> <span class="next"><a href="/learn-wgpu-ko/showcase/gifs/">
          GIF 만들기
        </a>
        →
      </span></p></div> </main></div></div><div class="global-ui"><!----></div></div>
    <script src="/learn-wgpu-ko/assets/js/app.ed4e872b.js" defer></script><script src="/learn-wgpu-ko/assets/js/3.d666109b.js" defer></script><script src="/learn-wgpu-ko/assets/js/2.3bb15672.js" defer></script><script src="/learn-wgpu-ko/assets/js/52.657fe2a7.js" defer></script><script src="/learn-wgpu-ko/assets/js/37.a2b9f953.js" defer></script>
  </body>
</html>
